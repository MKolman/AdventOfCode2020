<html>
<head>
	<title> Maks Kolman's Advent of Code 2020 </title>
</head>
<body style="width: 1000px; text-align: center; margin: auto;">
	<h1> Maks Kolman's Advent of Code 2020 </h1>
	<h2> Written in rust, compiled to web assembly </h2>
	Day:
	<select id="day">
		<option value="01">1</option>
	</select>
	&nbsp;&nbsp;&nbsp;&nbsp;
	Part:
	<select id="part">
		<option value="one">1</option>
		<option value="two">2</option>
	</select>
	<br>
	<br>
	<textarea cols="50" rows="10" id="input" placeholder="Paste your input here"></textarea>
	<br>
	<br>
	<button id="run">Run</button>
	<pre id="result">
	</pre>
	<br>
	<br>
	<pre id="code" style="text-align: left; background-color: #f5f5f5;">
	</pre>
	<a href="https://github.com/MKolman/AdventOfCode2020"> Hosted on GitHub </a>
	<h2> TODO </h2>
	<ul style="display: inline-block; text-align: left;">
		<li> colorize code </li>
		<li> remove 2019 solutions for day 1 and 2</li>
		<li> add some style</li>
	</ul>
	<script type="module">
		import init, * as aoc from "./pkg/adventofcode2020.js";
		init();
		const day = document.getElementById("day");
		const part = document.getElementById("part");
		const input = document.getElementById("input");
		const runButton = document.getElementById("run");
		const code = document.getElementById("code");

		for (let i = 2; i <= 25; i++) {
			const twoi = ("0" + i).slice(-2);
			if (aoc[`day${twoi}_part_one`] || aoc[`day${twoi}_part_two`]) {
				day.innerHTML += `<option value="${twoi}">${i}</option>`
			}
		}
		function run() {
			const funcName = `day${day.value}_part_${part.value}`;
			const func = aoc[funcName];
			if (!func) {
				result.innerHTML = `The solution for ${funcName} does not exist.`;
				return;
			}
			try {
				const startTime = new Date();
				result.innerText = func(input.value);
				const endTime = new Date();
				result.innerText += `\n Completed in ${(endTime - startTime)/1000}s`;

			} catch(e) {
				result.innerHTML = e.toString + "\n" + e.stack;
			}
		}
		runButton.addEventListener("click", run);

		function fetchInput() {
			fetch(`input/day${day.value}.txt`)
				.then(response => response.text())
				.then(data => input.value = data);
		}

		function fetchCode() {
			fetch(`src/day${day.value}.rs`)
				.then(response => response.text())
				.then(data => code.innerText = data);
		}
		day.addEventListener("change", fetchInput);
		day.addEventListener("change", fetchCode);
		fetchInput();
		fetchCode();
	</script>
</body>
</html>